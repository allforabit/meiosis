<!DOCTYPE html>
<html>
  <head>
    <title>Meiosis Tutorial</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="skeleton.css">
    <link rel="stylesheet" href="prism.css">
    <link rel="stylesheet" href="style.css">
  </head>
  <body class="container">
    <script src="prism.js" type="text/javascript"></script>
    <script src="https://flems.io/flems.html" type="text/javascript" charset="utf-8"></script>
    <h1><a href="https://meiosis.js.org">Meiosis</a> Tutorial</h1><p><a href="07-using-mithril.html">&lt; Previous</a> |
<a href="09-using-preact.html">Next &gt;</a> |
<a href="toc.html">Table of Contents</a></p>
<h2>08 - Using React</h2><p>In the <a href="06-components.html">06 - Components</a> lesson, we created the state management
code for an example with a <code>conditions</code> component and two temperature components, <code>air</code> and
<code>water</code>.</p>
<p>In this section, we&#39;ll wire this up to <a href="https://reactjs.org/">React</a>.</p>
<p><a name="wiring_meiosis"></a></p>
<h3><a href="#wiring_meiosis">Wiring Meiosis</a></h3><p>Remember that we had an <code>actions</code> object and a <code>states</code> stream:</p>
<pre><code class="language-js">var actions = app.actions(update);
states.map(function(state) {
  document.write(&quot;&lt;pre&gt;&quot; + JSON.stringify(state, null, 2) + &quot;&lt;/pre&gt;&quot;);
});</code></pre>
<p>Now, we&#39;ll use <code>ReactDOM.render</code> and a React component to render the view. We&#39;ll pass the
<code>actions</code> and <code>states</code> props to a top-level <code>App</code> component:</p>
<pre><code class="language-js">ReactDOM.render(&lt;App states={states} actions={actions} /&gt;,
  document.getElementById(&quot;app&quot;));</code></pre>
<p>Within the <code>App</code> component, we&#39;ll use <code>map</code> on the <code>states</code> stream and call <code>setState</code> so
that the view gets refreshed whenever the state changes.</p>
<p><a name="the_app_component"></a></p>
<h3><a href="#the_app_component">The App Component</a></h3><p>The <code>App</code> component retrieves <code>states</code> and <code>actions</code> from the passed-in props. We initialize
the React state, <code>this.state</code>, from the first value of the <code>states</code> stream. Then, in the
<code>componentDidMount</code> lifecycle method, we <code>map</code> the <code>states</code> stream and call <code>setState</code> so
that the view gets re-rendered when the state is updated.</p>
<p>In the <code>render</code> method, we retrieve the state from <code>this.state</code>, and the <code>actions</code> from the
props. We pass these on to other components, in this case <code>Conditions</code> and <code>Temperature</code>,
as props. Notice that we have two instances of <code>Temperature</code>, and we pass a different <code>id</code>
to each one.</p>
<pre><code class="language-js">class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = props.states();
  }
  componentDidMount() {
    var setState = this.setState.bind(this);
    this.props.states.map(function(state) {
      setState(state);
    });
  }
  render() {
    var state = this.state;
    var { actions } = this.props;
    return (&lt;div&gt;
      &lt;Conditions state={state} actions={actions} /&gt;
      &lt;Temperature state={state} id=&quot;air&quot; actions={actions} /&gt;
      &lt;Temperature state={state} id=&quot;water&quot; actions={actions} /&gt;
      &lt;pre&gt;{JSON.stringify(state, null, 4)}&lt;/pre&gt;
    &lt;/div&gt;);
  }
}</code></pre>
<p>Note that React will technically call <code>render()</code> twice initially: once after the constructor,
and once after <code>componentDidMount</code>. This may or may not be a problem depending on your
application. To prevent this, we can use a <code>skippedFirst</code> flag so that we don&#39;t initially
render twice:</p>
<pre><code class="language-js">class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = props.states();
    this.skippedFirst = false;
  }
  componentDidMount() {
    var setState = this.setState.bind(this);
    this.props.states.map(function(state) {
      if (this.skippedFirst) {
        setState(state);
      }
      else {
        this.skippedFirst = true;
      }
    });
  }
  render() {
    // same as before
}</code></pre>
<p><a name="the_conditions_component"></a></p>
<h3><a href="#the_conditions_component">The Conditions Component</a></h3><p>The <code>Conditions</code> component displays a checkbox for &quot;precipitations&quot; and a series of radio
butons for the sky (Sunny, Cloudy, Mix of sun/clouds). The <code>state</code> is used to reflect the
current state, and <code>actions</code> are called to update the state when the user changes the
checkbox and radio buttons:</p>
<pre><code class="language-js">var skyOption = function({ state, actions, value, label }) {
  return (&lt;label&gt;
    &lt;input type=&quot;radio&quot; id={value} name=&quot;sky&quot;
      value={value} checked={state.conditions.sky === value}
      onChange={evt =&gt; actions.changeSky(evt.target.value)}/&gt;
    {label}
  &lt;/label&gt;);
};

class Conditions extends React.Component {
  render() {
    var { state, actions } = this.props;
    return (&lt;div&gt;
      &lt;label&gt;
        &lt;input
          type=&quot;checkbox&quot;
          checked={state.conditions.precipitations}
          onChange={evt =&gt;
            actions.togglePrecipitations(evt.target.checked)
          }/&gt;
        Precipitations
      &lt;/label&gt;
      &lt;div&gt;
        {skyOption({ state, actions, value: &quot;SUNNY&quot;,
          label: &quot;Sunny&quot;})}
        {skyOption({ state, actions, value: &quot;CLOUDY&quot;,
          label: &quot;Cloudy&quot;})}
        {skyOption({ state, actions, value: &quot;MIX&quot;,
          label: &quot;Mix of sun/clouds&quot;})}
      &lt;/div&gt;
    &lt;/div&gt;);
  }
}</code></pre>
<p><a name="the_temperature_component"></a></p>
<h3><a href="#the_temperature_component">The Temperature Component</a></h3><p>The <code>Temperature</code> component is similar, except that it also receives an <code>id</code> and uses it to
read its state:</p>
<pre><code class="language-js">class Temperature extends React.Component {
  render() {
    var { state, id, actions } = this.props;
    return (&lt;div&gt;
      {state[id].label} Temperature:
      {state[id].value} &amp;deg; {state[id].units}
      &lt;div&gt;
        &lt;button
          onClick={() =&gt; actions.increment(id, 1)}&gt;
          Increment
        &lt;/button&gt;
        &lt;button
          onClick={() =&gt; actions.increment(id,-1)}&gt;
          Decrement
        &lt;/button&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;button
          onClick={() =&gt; actions.changeUnits(id)}&gt;
          Change Units
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;);
  }
}</code></pre>
<p>You can see the complete example below.</p>
<div id="flems1" class="flemscode" style="height:800px"></div>
  <script>
    window.Flems(flems1, {
      files: [{name: "08-using-react-01.js", content: "/*global React, ReactDOM, flyd, P, S, PS*/\nvar conditions = {\n  initialState: {\n    conditions: {\n      precipitations: false,\n      sky: \"Sunny\"\n    }\n  },\n  actions: function(update) {\n    return {\n      togglePrecipitations: function(value) {\n        update({ conditions: PS({ precipitations: value }) });\n      },\n      changeSky: function(value) {\n        update({ conditions: PS({ sky: value }) });\n      }\n    };\n  }\n};\n\nvar skyOption = function({ state, actions, value, label }) {\n  return (<label>\n    <input type=\"radio\" id={value} name=\"sky\"\n      value={value} checked={state.conditions.sky === value}\n      onChange={evt => actions.changeSky(evt.target.value)}/>\n    {label}\n  </label>);\n};\n\nclass Conditions extends React.Component {\n  render() {\n    var { state, actions } = this.props;\n    return (<div>\n      <label>\n        <input\n          type=\"checkbox\"\n          checked={state.conditions.precipitations}\n          onChange={evt =>\n            actions.togglePrecipitations(evt.target.checked)\n          }/>\n        Precipitations\n      </label>\n      <div>\n        {skyOption({ state, actions, value: \"SUNNY\",\n          label: \"Sunny\"})}\n        {skyOption({ state, actions, value: \"CLOUDY\",\n          label: \"Cloudy\"})}\n        {skyOption({ state, actions, value: \"MIX\",\n          label: \"Mix of sun/clouds\"})}\n      </div>\n    </div>);\n  }\n}\n\nvar convert = function(value, to) {\n  return Math.round(\n    (to === \"C\") ? ((value - 32) / 9 * 5) : (value * 9 / 5 + 32)\n  );\n};\n\nvar temperature = {\n  initialState: function(label) {\n    return {\n      label,\n      value: 22,\n      units: \"C\"\n    };\n  },\n  actions: function(update) {\n    return {\n      increment: function(id, amount) {\n        update({ [id]: PS({ value: S(x => x + amount) }) });\n      },\n      changeUnits: function(id) {\n        update({\n          [id]: S(state => {\n            var value = state.value;\n            var newUnits = state.units === \"C\" ? \"F\" : \"C\";\n            var newValue = convert(value, newUnits);\n            state.value = newValue;\n            state.units = newUnits;\n            return state;\n          })\n        });\n      }\n    };\n  }\n};\n\nclass Temperature extends React.Component {\n  render() {\n    var { state, id, actions } = this.props;\n    return (<div>\n      {state[id].label} Temperature:\n      {state[id].value} &deg; {state[id].units}\n      <div>\n        <button\n          onClick={() => actions.increment(id, 1)}>\n          Increment\n        </button>\n        <button\n          onClick={() => actions.increment(id,-1)}>\n          Decrement\n        </button>\n      </div>\n      <div>\n        <button\n          onClick={() => actions.changeUnits(id)}>\n          Change Units\n        </button>\n      </div>\n    </div>);\n  }\n}\n\nvar app = {\n  initialState: Object.assign({},\n    conditions.initialState,\n    { air: temperature.initialState(\"Air\") },\n    { water: temperature.initialState(\"Water\") }\n  ),\n  actions: function(update) {\n    return Object.assign({},\n      conditions.actions(update),\n      temperature.actions(update)\n    );\n  }\n};\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = props.states();\n  }\n  componentDidMount() {\n    var setState = this.setState.bind(this);\n    this.props.states.map(function(state) {\n      setState(state);\n    });\n  }\n  render() {\n    var state = this.state;\n    var { actions } = this.props;\n    return (<div>\n      <Conditions state={state} actions={actions} />\n      <Temperature state={state} id=\"air\" actions={actions} />\n      <Temperature state={state} id=\"water\" actions={actions} />\n      <pre>{JSON.stringify(state, null, 4)}</pre>\n    </div>);\n  }\n}\n\nvar update = flyd.stream();\nvar states = flyd.scan(P, app.initialState, update);\n\nvar actions = app.actions(update);\nReactDOM.render(<App states={states} actions={actions} />,\n  document.getElementById(\"app\"));\n", compiler: "babel"},{name: "app.html", content: "<div id=\"app\"></div>\n"},{name: "app.css", content: "body, button {\n  font-family: sans-serif;\n  font-size: 1rem;\n}\nbutton, button.light {\n  cursor: pointer;\n  padding: 2px 8px 2px 8px;\n  color: #5755d9;\n  background-color: #ffffff;\n  border: 1px solid #5755d9;\n  margin: 4px;\n}\nbutton:hover {\n  background-color: #eeeeee;\n}\nbutton.dark {\n  background-color: #5755d9;\n  color: #ffffff;\n}\nbutton.dark:hover {\n  background-color: #7775f9;\n}\n.temperature, .humidity {\n  margin-bottom: 20px;\n}\ninput {\n  margin-right: 4px;\n}\nlabel {\n  margin-right: 8px;\n}\n"}],
      links: [{name: "flyd", type: "js", url: "https://unpkg.com/flyd@0.2.8/flyd.js"},{name: "react", type: "js", url: "https://unpkg.com/react@16.7.0/umd/react.development.js"},{name: "react-dom", type: "js", url: "https://unpkg.com/react-dom@16.7.0/umd/react-dom.development.js"},{name: "patchinko", type: "js", url: "https://unpkg.com/patchinko@4.1.0/explicit.js"}],
      middle: 60
    })
  </script>


<p><a name="takeaways"></a></p>
<h3><a href="#takeaways">Takeaways</a></h3><p>We can wire up Meiosis to React using <code>ReactDOM.render</code> and passing <code>states</code> and <code>actions</code> as
props to the top-level <code>App</code> React component. This component initializes the React state and
calls <code>map</code> on the <code>states</code> stream to call <code>setState</code> when the state changes and automatically
refresh the view.</p>
<p>Then, all other React components in the application are consistent: they all receive <code>state</code>
and <code>actions</code> props. When rendering other components, <code>state</code> and <code>actions</code> are passed along.
When a component is used multiple times, or when you want to define the state property outside of
the component, you also pass the <code>id</code>.</p>
<p>Components can then use the <code>state</code> to render the view according to the current application
state, and call <code>actions</code> to trigger changes.</p>
<p><a name="conclusion"></a></p>
<h3><a href="#conclusion">Conclusion</a></h3><p>This concludes the Meiosis tutorial. See <a href="11-whats-next.html">11 - What&#39;s Next?</a> for ideas on where
to go from here.</p>
<p><a href="07-using-mithril.html">&lt; Previous</a> |
<a href="09-using-preact.html">Next &gt;</a> |
<a href="toc.html">Table of Contents</a></p>
<hr>
<p><a href="https://meiosis.js.org">Meiosis</a> is developed by <a href="http://twitter.com/foxdonut00">@foxdonut00</a> / <a href="https://github.com/foxdonut">foxdonut</a> and is released under the MIT license.</p>
  </body>
</html>