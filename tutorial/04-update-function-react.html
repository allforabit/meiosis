<!DOCTYPE html>
<html>
  <head>
    <title>Meiosis Tutorial</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="skeleton.css">
    <link rel="stylesheet" href="prism.css">
    <link rel="stylesheet" href="style.css">
  </head>
  <body class="container">
    <script src="prism.js" type="text/javascript"></script>
    <script src="https://flems.io/flems.html" type="text/javascript" charset="utf-8"></script>
    <h1><a href="https://meiosis.js.org">Meiosis</a> Tutorial</h1><p><a href="toc.html">Table of Contents</a></p>
<h2>04 - Update Function</h2><p>In the previous lesson, <a href="03-update-model-react.html">03 - Update Model</a>, we added a button
to the view and associated a function to <code>onclick</code>. That function made a change to the model
and re-rendered the view with the updated model.</p>
<pre><code class="language-js">var increase = function(_event) {
  model = model + 1;
  ReactDOM.render(view(model), element);
};</code></pre>
<h3>Extracting out the details</h3><p>Notice that the function above needs to &quot;know&quot; about the details of how to re-render the view:</p>
<ul>
<li>It calls <code>ReactDOM.render</code></li>
<li>It references the <code>element</code></li>
<li>It references the <code>model</code></li>
<li>It references the <code>view</code> function.</li>
</ul>
<p>That&#39;s a lot of details tied into that function! We do not want these details tied into view
functions. As we build larger applications, we&#39;ll have more view functions and more event
handler functions, and we don&#39;t want all these references tied in everywhere.</p>
<p>Let&#39;s extract those details out into an <code>update</code> function:</p>
<pre><code class="language-js">var update = function(value) {
  model = model + value;
  ReactDOM.render(view(model), element);
};</code></pre>
<p>Now the <code>increase</code> function just needs to call <code>update(1)</code> to increase the value by 1 and re-render
the view. As you will see, this <code>update</code> function will only be in one place.</p>
<h3>Event handler function</h3><p>Our <code>increase</code> function can now be:</p>
<pre><code class="language-js">var increase = function(_event) {
  update(1);
};</code></pre>
<p>And a <code>decrease</code> function could be:</p>
<pre><code class="language-js">var decrease = function(_event) {
  update(-1);
};</code></pre>
<p>But instead of having separate functions for what are just different values that we pass to
<code>update</code>, we can write a single function that gets the <strong>amount</strong> by which to increase, and
<strong>returns a function</strong> that calls <code>update</code> with that amount:</p>
<pre><code class="language-js">var increase = function(amount) {
  return function(_event) {
    update(amount);
  };
};</code></pre>
<p>As you can see, <strong>functions are values</strong> and, like other values, they can be <strong>returned</strong> as a
result of calling a function. They can also be passed as values to other functions.</p>
<p>So what does this buy us? We can call <code>increase(1)</code> and <code>increase(-1)</code> to associate event handlers
to the <code>increase</code> and <code>decrease</code> buttons:</p>
<pre><code class="language-html">&lt;button onClick={increase( 1)}&gt;+1&lt;/button&gt;
&lt;button onClick={increase(-1)}&gt;-1&lt;/button&gt;</code></pre>
<p>Remember that <code>onclick</code> needs a <code>function(event)</code>, and that is what we are getting by calling
<code>increase(1)</code> and <code>increase(-1)</code>.</p>
<p><img src="04-update-function-01.svg" alt="Event Handler Function"></p>
<h3>The <code>createView</code> function</h3><p>I mentioned that the <code>update</code> function would be defined in one single place. Since the view
needs <code>update</code>, we&#39;ll write a <code>createView</code> function that receives <code>update</code> as a parameter:</p>
<pre><code class="language-js">var createView = function(update) {
  var increase = function(amount) {
    return function(_event) {
      update(amount);
    };
  };
  var view = function(model) {
    return (&lt;div&gt;
      &lt;div&gt;Counter: {model}&lt;/div&gt;
      &lt;button onClick={increase( 1)}&gt;+1&lt;/button&gt;
      &lt;button onClick={increase(-1)}&gt;-1&lt;/button&gt;
    &lt;/div&gt;);
  };
  return view;
};</code></pre>
<p>By receiving <code>update</code> as a parameter, our <code>createView</code> function is not tied to anything outside of
the function itself. It does not reference <code>update</code> as a global variable.</p>
<p>Also notice that <code>createView</code> is another function-that-returns-a-function. After setting up the
<code>increase</code> event handler, it creates and returns the <code>view</code> function, which continues to be a
function that takes a <code>model</code> and returns a view.</p>
<h3>Putting it all together</h3><p>Here is the complete example:</p>
  <div id="flems1" class="flemscode" style="height:800px"></div>

  <script>
    window.Flems(flems1, {
      files: [{name: "04-update-function.js", content: "/*global React, ReactDOM*/\n\n// -- Application code\n\nvar createView = function(update) {\n  var increase = function(amount) {\n    return function(_event) {\n      update(amount);\n    };\n  };\n  var view = function(model) {\n    return (<div>\n      <div>Counter: {model}</div>\n      <button onClick={increase( 1)}>+1</button>\n      <button onClick={increase(-1)}>-1</button>\n    </div>);\n  };\n  return view;\n};\n\n// -- Meiosis pattern setup code\n\nvar model = 0;\nvar element = document.getElementById(\"app\");\nvar view = null;\n\nvar update = function(value) {\n  model = model + value;\n  ReactDOM.render(view(model), element);\n};\n\nview = createView(update);\nReactDOM.render(view(model), element);\n", compiler: "babel"},{name: "app.html", content: "<div id=\"app\"></div>\n"},{name: "app.css", content: "body, button {\n  font-family: sans-serif;\n  font-size: 1rem;\n}\nbutton, button.light {\n  cursor: pointer;\n  padding: 2px 8px 2px 8px;\n  color: #5755d9;\n  background-color: #ffffff;\n  border: 1px solid #5755d9;\n  margin: 4px;\n}\nbutton:hover {\n  background-color: #eeeeee;\n}\nbutton.dark {\n  background-color: #5755d9;\n  color: #ffffff;\n}\nbutton.dark:hover {\n  background-color: #7775f9;\n}\n.temperature {\n  margin-bottom: 20px;\n}"}],
      links: [{name: "react", type: "js", url: "https://unpkg.com/react@16.4.1/umd/react.development.js"},{name: "react-dom", type: "js", url: "https://unpkg.com/react-dom@16.4.1/umd/react-dom.development.js"}],
      middle: 75
    })
  </script>


<p>By extracting the details out of the <code>increase</code> function and passing in <code>update</code> as a parameter,
we&#39;ve separated the <strong>application code</strong> from the <strong>Meiosis pattern setup code</strong>. The
application code is concerned with creating views, event handlers, and issuing updates, without
being tied to any details about data flow and rendering. The Meiosis pattern setup code takes care
of the &quot;wiring up&quot; - initializing the model, setting up the <code>update</code> function, creating the view
function, and rendering the results onto the page. As we build larger applications, the application
can grow and only need to know about the passed-in <code>update</code> function. The Meiosis pattern setup
code only needs to be written once, and does not need to change as we build more features in the
application code.</p>
<h3>Exercises</h3><ol>
<li>Add two buttons, which increase and decrease the counter by 5. You should only have to add
two lines of code to do this.</li>
<li>Change the initial value of the model to <code>1</code>. Then, change how the model gets updated, by
<strong>multiplying</strong> instead of adding the incoming value. Verify that <code>+1</code> has no effect, <code>-1</code>
only changes the sign, and <code>+5</code> and<code>-5</code> multiply by <code>5</code> and <code>-5</code> respectively.</li>
</ol>
<p>When you are ready, continue on to <a href="05-stream-react.html">05 - Stream</a>.</p>
<p><a href="toc.html">Table of Contents</a></p>
<hr>
<p><a href="https://meiosis.js.org">Meiosis</a> is developed by <a href="http://twitter.com/foxdonut00">@foxdonut00</a> / <a href="https://github.com/foxdonut">foxdonut</a> and is released under the MIT license.</p>
  </body>
</html>
